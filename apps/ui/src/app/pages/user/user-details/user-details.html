<div class="container mt-4">
  @if (isProfileMode) {
    <h2>{{ 'Modifier mon profil' }}</h2>
  } @else {
    <h2>{{ isEditMode ? 'Modifier un utilisateur' : 'Créer un utilisateur' }}</h2>
  }

  <form (ngSubmit)="onSubmit()" #userForm="ngForm" novalidate>
    <div class="mb-3 position-relative">
      <label for="email" class="form-label">Email *</label>
      <input
        id="email"
        name="email"
        type="email"
        class="form-control"
        [(ngModel)]="user.email"
        required
        pattern="[a-zA-Z0-9._%+\-]+@[a-zA-Z0-9.\-]+\.[a-zA-Z]{2,}"
        #emailRef="ngModel"
        [class.is-invalid]="emailRef.invalid && (emailRef.dirty || emailRef.touched || formSubmitted)"
      />
      <div class="invalid-feedback"
           *ngIf="emailRef.errors?.['required'] && (emailRef.dirty || emailRef.touched || formSubmitted)">
        Email requis.
      </div>
      <div class="invalid-feedback"
           *ngIf="emailRef.errors?.['pattern'] && (emailRef.dirty || emailRef.touched || formSubmitted)">
        Format d'email invalide.
      </div>
    </div>

    <div *ngIf="!isEditMode" class="mb-3 position-relative">
      <label for="password" class="form-label">Mot de passe *</label>
      <input
        id="password"
        name="password"
        type="password"
        class="form-control"
        [(ngModel)]="user.password"
        required
        pattern="^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{8,}$"
        #passwordRef="ngModel"
        [class.is-invalid]="passwordRef.invalid && (passwordRef.dirty || passwordRef.touched || formSubmitted)"
      />
      <div class="invalid-feedback"
           *ngIf="passwordRef.errors?.['required'] && (passwordRef.dirty || passwordRef.touched || formSubmitted)">
        Mot de passe requis.
      </div>
      <div class="invalid-feedback"
           *ngIf="passwordRef.errors?.['pattern'] && (passwordRef.dirty || passwordRef.touched || formSubmitted)">
        Min 8 caractères, 1 majuscule, 1 minuscule, 1 chiffre.
      </div>
    </div>

    <div class="mb-3 position-relative">
      <label for="firstName" class="form-label">Prénom *</label>
      <input
        id="firstName"
        name="firstName"
        type="text"
        class="form-control"
        [(ngModel)]="user.firstName"
        required
        #firstNameRef="ngModel"
        [class.is-invalid]="firstNameRef.invalid && (firstNameRef.dirty || firstNameRef.touched || formSubmitted)"
      />
      <div class="invalid-feedback"
           *ngIf="firstNameRef.errors?.['required'] && (firstNameRef.dirty || firstNameRef.touched || formSubmitted)">
        Prénom requis.
      </div>
    </div>

    <div class="mb-3 position-relative">
      <label for="lastName" class="form-label">Nom *</label>
      <input
        id="lastName"
        name="lastName"
        type="text"
        class="form-control"
        [(ngModel)]="user.lastName"
        required
        #lastNameRef="ngModel"
        [class.is-invalid]="lastNameRef.invalid && (lastNameRef.dirty || lastNameRef.touched || formSubmitted)"
      />
      <div class="invalid-feedback"
           *ngIf="lastNameRef.errors?.['required'] && (lastNameRef.dirty || lastNameRef.touched || formSubmitted)">
        Nom requis.
      </div>
    </div>

    <div class="mb-3 position-relative">
      <label for="phoneNumber" class="form-label">Téléphone</label>
      <input
        id="phoneNumber"
        name="phoneNumber"
        type="text"
        class="form-control"
        [(ngModel)]="user.phoneNumber"
      />
    </div>

    <div class="mb-3 position-relative">
      <label for="address" class="form-label">Adresse</label>
      <input
        id="address"
        name="address"
        type="text"
        class="form-control"
        [(ngModel)]="user.address"
      />
    </div>

    @if (!isProfileMode) {
      <div class="mb-3 position-relative">
        <label for="role" class="form-label">Rôle</label>
        <select
          id="role"
          name="role"
          class="form-select"
          [(ngModel)]="user.role"
        >
          <option [ngValue]="null">Sélectionner un rôle</option>
          <option *ngFor="let r of roles" [ngValue]="r">{{ r }}</option>
        </select>
      </div>
    }

    <button type="submit" class="btn btn-primary" [disabled]="!isValid()">
      {{ isEditMode ? 'Modifier' : 'Créer' }}
    </button>
  </form>
</div>
